--[[
    WARNING: Heads up! This script has not been verified by ScriptBlox. Use at your own risk!
]]
-- All credits to LeviTheOtaku from v3rmillion.net - https://v3rmillion.net/showthread.php?tid=970595 / https://v3rmillion.net/member.php?action=profile&uid=11841

-- Функция для создания GUI
local function createGui(parent)
    local PiggyGui = Instance.new("ScreenGui")
    PiggyGui.Name = "PiggyGui"
    PiggyGui.Parent = parent

    local ScrollingFrame = Instance.new("ScrollingFrame", PiggyGui)
    ScrollingFrame.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
    ScrollingFrame.Position = UDim2.new(0.08, 0, 0.42, 0)
    ScrollingFrame.Size = UDim2.new(0, 296, 0, 388)
    
    local UIGridLayout = Instance.new("UIGridLayout", ScrollingFrame)
    UIGridLayout.CellSize = UDim2.new(0, 90, 0, 90)
    
    return ScrollingFrame
end

local scrollingFrame1 = createGui(game.StarterGui)
local scrollingFrame2 = createGui(game.CoreGui)

-- Функция для поиска уникальных предметов (без дублирования) по наличию ItemPickupScript или ClickDetector
local function getItems()
    local descendants = workspace:GetDescendants()
    local uniqueItems = {}  -- словарь для уникальных объектов
    local items = {}        -- результирующий массив
    
    for i = 1, #descendants do
        local obj = descendants[i]
        if obj.Name == "ItemPickupScript" or obj.Name == "ClickDetector" then
            local parent = obj.Parent
            if parent and not uniqueItems[parent] then
                uniqueItems[parent] = true
                print("Найден предмет: " .. parent:GetFullName())
            end
        end
    end
    
    for item, _ in pairs(uniqueItems) do
        table.insert(items, item)
    end
    return items
end

-- Основной цикл обновления GUI
while wait(1) do
    local items = getItems()
    
    -- Удаляем старые кнопки
    for _, child in ipairs(scrollingFrame2:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end

    -- Создаем для каждого найденного предмета кнопку с ViewportFrame
    for i = 1, #items do
        local object = items[i]
        
        local ItemFrame = Instance.new("TextButton", scrollingFrame2)
        ItemFrame.Name = "ItemFrame"
        ItemFrame.BackgroundColor3 = Color3.new(1, 1, 1)
        ItemFrame.BackgroundTransparency = 0.95
        ItemFrame.Size = UDim2.new(0, 100, 0, 100)
        ItemFrame.Text = ""
        
        local View = Instance.new("ViewportFrame", ItemFrame)
        View.Name = "View"
        View.Size = UDim2.new(1, 0, 1, 0)
        View.BackgroundTransparency = 1
        View.BorderSizePixel = 0
        
        local viewportClone = object:Clone()
        viewportClone.Parent = View
        
        local cam = Instance.new("Camera", viewportClone)
        cam.CameraType = Enum.CameraType.Fixed
        
        local objectPosition = object.Position
        local cameraPosition = objectPosition + Vector3.new(0, 3, 0)
        cam.CFrame = CFrame.new(cameraPosition, objectPosition)
        View.CurrentCamera = cam
        
        ItemFrame.MouseButton1Down:Connect(function()
            local player = game.Players.LocalPlayer
            local character = player.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                local originalCFrame = character.HumanoidRootPart.CFrame
                wait(0.05)
                character.HumanoidRootPart.CFrame = object.CFrame
                wait(0.1)
                -- Если у объекта есть ClickDetector, вызываем его, иначе выводим предупреждение
                local clickDetector = object:FindFirstChild("ClickDetector")
                if clickDetector then
                    fireclickdetector(clickDetector)
                else
                    print("У объекта " .. object.Name .. " отсутствует ClickDetector")
                end
                wait(0.3)
                character.HumanoidRootPart.CFrame = originalCFrame
            end
        end)
    end
end
